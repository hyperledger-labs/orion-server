<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/orion-server/blog/rss.xml" title="Hyperledger Orion RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/orion-server/blog/atom.xml" title="Hyperledger Orion Atom Feed"><title data-react-helmet="true">Ledger Data and Cryptographical Proofs | Hyperledger Orion</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://hyperledger-labs.github.io/orion-server/docs/getting-started/proofs-and-verification/proofs"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Ledger Data and Cryptographical Proofs | Hyperledger Orion"><meta data-react-helmet="true" name="description" content="Ledger Data and Cryptographical Proofs"><meta data-react-helmet="true" property="og:description" content="Ledger Data and Cryptographical Proofs"><link data-react-helmet="true" rel="shortcut icon" href="/orion-server/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hyperledger-labs.github.io/orion-server/docs/getting-started/proofs-and-verification/proofs"><link data-react-helmet="true" rel="alternate" href="https://hyperledger-labs.github.io/orion-server/docs/getting-started/proofs-and-verification/proofs" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hyperledger-labs.github.io/orion-server/docs/getting-started/proofs-and-verification/proofs" hreflang="x-default"><link rel="stylesheet" href="/orion-server/assets/css/styles.f8b45538.css">
<link rel="preload" href="/orion-server/assets/js/runtime~main.3b1b7571.js" as="script">
<link rel="preload" href="/orion-server/assets/js/main.08f2dd10.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_Zhym">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/orion-server/"><div class="navbar__logo"><img src="/orion-server/img/logo.svg" alt="Orion" class="themedImage_X7X7 themedImage--light_n7cD"><img src="/orion-server/img/logo.svg" alt="Orion" class="themedImage_X7X7 themedImage--dark_WTCb"></div><b class="navbar__title">Orion</b></a><a class="navbar__item navbar__link" href="/orion-server/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/orion-server/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hyperledger-labs/orion-server" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_tjMl"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_7DKP toggle_gM5N toggleDisabled_YcJ9"><div class="toggleTrack_pr3n" role="button" tabindex="-1"><div class="toggleTrackCheck_1VIP"><span class="toggleIcon_iGPa">ðŸŒœ</span></div><div class="toggleTrackX_-cNO"><span class="toggleIcon_iGPa">ðŸŒž</span></div><div class="toggleTrackThumb_4edW"></div></div><input type="checkbox" class="toggleScreenReader_BFa8" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_ntW3"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_Cy7D" type="button"></button><aside class="docSidebarContainer_ZbqI"><div class="sidebar_bpFd"><nav class="menu thin-scrollbar menu_fJBT"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/orion-server/docs/introduction">Hyperledger Orion</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Getting Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/orion-server/docs/getting-started/guide">Using Orion</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Launching a Orion Node</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Pre-requisite For Executing Transactions and Queries</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Executing Transactions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Executing Queries</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Executing Proof Generation and Verification</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/orion-server/docs/getting-started/proofs-and-verification/proofs">Ledger Data and Cryptographical Proofs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Using Go SDK</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Using Curl command</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Design Principles</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">User Cases</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Architecture and Design</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security and Trust Model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/orion-server/docs/rest-api-specifications">REST API Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/orion-server/docs/roadmap">Roadmap</a></li></ul></nav></div></aside><main class="docMainContainer_QBea"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_R67y"><div class="docItemContainer_fRP7"><article><div class="tocCollapsible_caTw theme-doc-toc-mobile tocMobile_QgRD"><button type="button" class="clean-btn tocCollapsibleButton_YFWb">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Ledger Data and Cryptographical Proofs</h1></header><h2 class="anchor anchorWithStickyNavbar_7Y9k" id="ledger-data-and-cryptographical-proofs">Ledger Data and Cryptographical Proofs<a aria-hidden="true" class="hash-link" href="#ledger-data-and-cryptographical-proofs" title="Direct link to heading">â€‹</a></h2><p>The ledger API gives the user access to the data stored in Orion ledger and is used to prove data integrity and provide tamper resistance and non-repudiation.
For more information about data structures exposed by the ledger, see <a href="/orion-server/docs/architecture-and-design/block-skip-chain">block skip chain</a>, <a href="/orion-server/docs/architecture-and-design/tx-merkle-tree">Transactions merkle tree</a>, and <a href="/orion-server/docs/architecture-and-design/state-merkle-patricia-tree">state trie</a>.</p><p>The ledger API give users detailed access to ledger data and integrity proofs, including:</p><ul><li>block header data</li><li>proof of transaction existence in block </li><li>proof of block(s) existence in ledger </li><li>proof of specific db <code>key-&gt;value</code> existence at specific (block) time </li><li>receipt for specific tx</li></ul><p>There are multiple ways to access ledger data, including proofs. First, there are multiple SDKs (including GO, for details see <a href="/orion-server/docs/getting-started/proofs-and-verification/gosdk/ledger">here</a>)
and the REST API that can expose access to the server. For details, see <a href="/orion-server/docs/getting-started/proofs-and-verification/curl/ledger">here</a>.</p><p>Based on provenance and ledger APIs, we can check:</p><ul><li>ledger integrity, by accessing block headers and validating the consistency of the ledger skip list</li><li>transaction existence proof, composed of the Merkle tree path to the transaction in the block and the block existence proof: <code>GetTransactionProof()</code> and <code>GetLedgerPath()</code></li><li>block existence proof, from TxReceipt or by accessing block headers and validating the consistency of the ledger skip list</li><li>proof of active and past states, by <code>GetStateProof()</code> proving existence of all state changes</li></ul><h3 class="anchor anchorWithStickyNavbar_7Y9k" id="detailed-proofs">Detailed proofs<a aria-hidden="true" class="hash-link" href="#detailed-proofs" title="Direct link to heading">â€‹</a></h3><p>The block proof contains a connected list of blocks from the end block to the start block.</p><div class="codeBlockContainer_8VJT"><div class="codeBlockContent_meoT protobuf"><pre tabindex="0" class="prism-code language-protobuf codeBlock_ltyB thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_ZWp2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">message GetLedgerPathResponse {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ResponseHeader header = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  repeated BlockHeader block_headers = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TFIO clean-btn">Copy</button></div></div><p>The transaction proof contains the path in the Merkle tree in the block to the root.</p><div class="codeBlockContainer_8VJT"><div class="codeBlockContent_meoT protobuf"><pre tabindex="0" class="prism-code language-protobuf codeBlock_ltyB thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_ZWp2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">message GetTxProofResponse {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ResponseHeader header = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  repeated bytes hashes = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TFIO clean-btn">Copy</button></div></div><p>The state proof contains the path in the block Merkle-Patricia trie from the leaf (key,value) to the root.</p><div class="codeBlockContainer_8VJT"><div class="codeBlockContent_meoT protobuf"><pre tabindex="0" class="prism-code language-protobuf codeBlock_ltyB thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_ZWp2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">message GetDataProofResponse {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ResponseHeader header = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  repeated MPTrieProofElement path = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message MPTrieProofElement {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  repeated bytes hashes = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_TFIO clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_7Y9k" id="proofs">Proofs<a aria-hidden="true" class="hash-link" href="#proofs" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_7Y9k" id="ledger-connectivity-proof">Ledger connectivity proof<a aria-hidden="true" class="hash-link" href="#ledger-connectivity-proof" title="Direct link to heading">â€‹</a></h4><p>Proof generation:</p><ol><li>Alice is provided with a receipt (block header) from Bob who claim×“ that some block is part of the ledger.</li><li>Alice requests from the server the header of the last block in the ledger, without revealing to the server which block she wants to validate. <ul><li>She can store the genesis block a-priori or request it as well.</li></ul></li><li>Alice requests the shortest path in the skip list from the block she validates to the genesis block.</li><li>Alice requests the shortest path from the last block of the ledger (2) to the block she validates</li><li>Alice validates all a-priori known headers - genesis, block, last - in both paths and concatenates both paths; the result is the block proof.</li></ol><p>To check the proof validity for each block header in the proof starting from the genesis block, Alice executes the following steps:</p><ol><li>She calculates the block header hash.</li><li>If the calculated hash is in the next block header skip-list hash list, continue.</li><li>If not, fail.</li></ol><p>Optimization - because the result of each call to <code>Commit()</code> is a transaction receipt containing a block header, the user can use this header if it has a higher block number than the block he wants to validate, thus avoiding the need to ask the server for the last block.</p><p>Please note that the algorithm above allows the user to build proofs from multiple blocks.
For example, proof for blocks 3 and 5 will include (8, 6, 5, 4, 3, 2, 0). It is useful while validating specific value history.</p><p>The above algorithm is used as the first step of the <a href="#transaction-existence-proof">transaction proof</a>/<a href="#state-proof">state proof</a> to prove that block(s) is/are part of the ledger.</p><h4 class="anchor anchorWithStickyNavbar_7Y9k" id="transaction-existence-proof">Transaction existence proof<a aria-hidden="true" class="hash-link" href="#transaction-existence-proof" title="Direct link to heading">â€‹</a></h4><p>Here is a detailed explanation of the transaction existence proof, based on data stored during the tx commit.</p><ul><li>Alice submits a tx and in the future should be able to prove its existence:</li><li>During the transaction commit, <code>TxReceipt</code> containing the block header is returned as proof.<ul><li>The transaction content and <code>TxReceipt</code> are stored by Alice to use as proof to other users in the future.</li></ul></li><li>At some point in the future, Alice needs to prove (to Bob) that tx is part of the ledger, using the proof stored since the tx commit.<ul><li>Alice provides Bob with <code>TxReceipt</code>, signed by the server, and the transaction content, signed by Alice.</li><li>First, Bob checks ledger connectivity and that the block header in <code>TxReceipt</code> is part of the ledger, as described <a href="#ledger-connectivity-proof">here</a>.</li><li>Second, Bob calls <code>GetTxProof()</code> for the tx path in the block Merkle tree and the tx content already provided by Alice.</li><li>Bob validates the proof using the tx hash and Merkle root stored in the block header. For more details, see <a href="/orion-server/docs/architecture-and-design/tx-merkle-tree#merkle-tree-proof-example">here</a>. </li></ul></li></ul><p><img alt="tx_proof" src="/orion-server/assets/images/TxProof-a82baa6b34df458bb7739d8bbd06497c.png"></p><h4 class="anchor anchorWithStickyNavbar_7Y9k" id="state-proof">State proof<a aria-hidden="true" class="hash-link" href="#state-proof" title="Direct link to heading">â€‹</a></h4><p>Here is a detailed explanation of the historical state proof, based on data stored in Merkle-Patricia Trie.</p><ul><li>Alice wants to get cryptographic proof from the server that that key <code>K</code> was associated with value <code>X</code> at the end of block <code>N</code>.</li><li>Alice asks the server to <code>BlockHeader</code> for block <code>N</code>.</li><li>As described <a href="#ledger-connectivity-proof">here</a>, Alice checks ledger connectivity and that the block header <code>N</code> is part of the ledger.</li><li>Alice calls to <code>GetDataProof()</code> and verifies it:<ul><li>Calculates hash of <code>&lt;db, key, value&gt;</code> tuple by calling <code>ConstructCompositeKey</code> and <code>CalculateKeyValueHash</code></li><li>Call to <code>proof.Verify()</code></li></ul></li></ul><p><img alt="state_proof" src="/orion-server/assets/images/StateProof-5dbae9f8a9b98bc991eeb1328b26f637.png"></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/orion-server/docs/getting-started/queries/curl/transaction-receipt"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Query a Transaction Receipt</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/orion-server/docs/getting-started/proofs-and-verification/gosdk/state"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Proof of Existence of a State/Data<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_1gSR thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ledger-data-and-cryptographical-proofs" class="table-of-contents__link toc-highlight">Ledger Data and Cryptographical Proofs</a><ul><li><a href="#detailed-proofs" class="table-of-contents__link toc-highlight">Detailed proofs</a></li><li><a href="#proofs" class="table-of-contents__link toc-highlight">Proofs</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/orion-server/docs/getting-started/guide">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/orion" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_tjMl"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/orion" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_tjMl"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/orion" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_tjMl"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/orion-server/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/hyperledger-labs/orion-server" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_tjMl"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Hyperledger Orion</div></div></div></footer></div>
<script src="/orion-server/assets/js/runtime~main.3b1b7571.js"></script>
<script src="/orion-server/assets/js/main.08f2dd10.js"></script>
</body>
</html>