"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[640],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>m});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=a.createContext({}),d=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},p=function(e){var n=d(e.components);return a.createElement(l.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},h=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=d(t),h=i,m=c["".concat(l,".").concat(h)]||c[h]||u[h]||r;return t?a.createElement(m,s(s({ref:n},p),{},{components:t})):a.createElement(m,s({ref:n},p))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,s=new Array(r);s[0]=h;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o[c]="string"==typeof e?e:i,s[1]=o;for(var d=2;d<r;d++)s[d]=t[d];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}h.displayName="MDXCreateElement"},8589:(e,n,t)=>{t.r(n),t.d(n,{contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var a=t(7462),i=(t(7294),t(3905));const r={id:"usertx",title:"User Administration Transaction"},s="User Administration Transaction",o={unversionedId:"getting-started/transactions/curl/usertx",id:"getting-started/transactions/curl/usertx",isDocsHomePage:!1,title:"User Administration Transaction",description:"We can create, update, and delete users of the Orion cluster using the user administration transaction. By issuing a POST /user/tx , we can carry out user administration.",source:"@site/docs/getting-started/transactions/curl/usertx.md",sourceDirName:"getting-started/transactions/curl",slug:"/getting-started/transactions/curl/usertx",permalink:"/orion-server/docs/getting-started/transactions/curl/usertx",tags:[],version:"current",frontMatter:{id:"usertx",title:"User Administration Transaction"},sidebar:"Documentation",previous:{title:"Database Administration Transaction",permalink:"/orion-server/docs/getting-started/transactions/curl/dbtx"},next:{title:"Data Transaction",permalink:"/orion-server/docs/getting-started/transactions/curl/datatx"}},l=[{value:"1) Adding Users",id:"1-adding-users",children:[{value:"1.1) Adding users <code>alice</code> and <code>bob</code>",id:"11-adding-users-alice-and-bob",children:[],level:3},{value:"1.2) Check the existence of alice",id:"12-check-the-existence-of-alice",children:[],level:3},{value:"1.3) Check the existence of bob",id:"13-check-the-existence-of-bob",children:[],level:3}],level:2},{value:"2) Updating a User",id:"2-updating-a-user",children:[{value:"2.1) Remove all privileges of <code>alice</code>",id:"21-remove-all-privileges-of-alice",children:[],level:3},{value:"2.2) Check the privilege of <code>alice</code>",id:"22-check-the-privilege-of-alice",children:[],level:3}],level:2},{value:"3) Deleting a User",id:"3-deleting-a-user",children:[{value:"3.1) Delete the user <code>alice</code>",id:"31-delete-the-user-alice",children:[],level:3},{value:"3.2) Check the non-existence of the user <code>alice</code>",id:"32-check-the-non-existence-of-the-user-alice",children:[],level:3}],level:2}],d={toc:l};function p(e){let{components:n,...t}=e;return(0,i.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"user-administration-transaction"},"User Administration Transaction"),(0,i.kt)("p",null,"We can create, update, and delete users of the Orion cluster using the user administration transaction. By issuing a ",(0,i.kt)("inlineCode",{parentName:"p"},"POST /user/tx {txPayload}"),", we can carry out user administration."),(0,i.kt)("p",null,"In this document, we present examples for:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"#2-adding-users"},"Adding users")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"#3-updating-a-user"},"Updating users")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"#4-deleting-a-user"},"Deleting users"))),(0,i.kt)("p",null,"Note that all user administration transactions must be submitted by the admin."),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"It is recommended to start a fresh Orion server for executing these examples. Otherwise, you must carefully change the block number specified as\npart of the version in the read-set of the transaction payload. This document explains this issue in detail. Once a fresh Orion server is started\nafter removing the ",(0,i.kt)("inlineCode",{parentName:"p"},"ledger")," directory, create two databases named ",(0,i.kt)("inlineCode",{parentName:"p"},"db1")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"db2"),". Refer ",(0,i.kt)("a",{parentName:"p",href:"/orion-server/docs/getting-started/transactions/curl/dbtx#create-databases-named-db1-and-db2"},"here"),"\nfor an example ",(0,i.kt)("inlineCode",{parentName:"p"},"cURL")," command for creating databases named ",(0,i.kt)("inlineCode",{parentName:"p"},"db1")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"db2"),"."))),(0,i.kt)("h2",{id:"1-adding-users"},"1) Adding Users"),(0,i.kt)("h3",{id:"11-adding-users-alice-and-bob"},"1.1) Adding users ",(0,i.kt)("inlineCode",{parentName:"h3"},"alice")," and ",(0,i.kt)("inlineCode",{parentName:"h3"},"bob")),(0,i.kt)("p",null,"When the cluster is started for the first time, it contains only the admin user specified in the ",(0,i.kt)("inlineCode",{parentName:"p"},"config.yml"),". This admin user can add any other user to the cluster.\nIn the below example, the admin user is adding two users named ",(0,i.kt)("inlineCode",{parentName:"p"},"alice")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"bob")," with certain privileges. The crypto materials associated with ",(0,i.kt)("inlineCode",{parentName:"p"},"alice")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"bob")," can\nbe found in ",(0,i.kt)("inlineCode",{parentName:"p"},"/deployment/sample/crypto"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'curl \\\n    -H "Content-Type: application/json" \\\n    -H "TxTimeout: 10s" \\\n    -X POST http://127.0.0.1:6001/user/tx \\\n    --data \'{\n        "payload": {\n            "user_id": "admin",\n            "tx_id": "7b6d6414-9b58-45d0-9723-1f31712add01",\n            "user_writes": [\n                {\n                    "user": {\n                        "id": "alice",\n                        "certificate": "MIIBsjCCAVigAwIBAgIRAJp7i/UhOnaawHTSdkzxR1QwCgYIKoZIzj0EAwIwHjEcMBoGA1UEAxMTQ2FyIHJlZ2lzdHJ5IFJvb3RDQTAeFw0yMTA2MTYxMTEzMjdaFw0yMjA2MTYxMTE4MjdaMCQxIjAgBgNVBAMTGUNhciByZWdpc3RyeSBDbGllbnQgYWxpY2UwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASdCmAgHdqck7uhAK5siEF/O1EIUEIYtiR3XVEjbVhNe/6GXFShtsSThXYL9/XK6p4qF4oSy9j/PURMGnWbzSnso3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiEAsRZlR4sDyxS//BJnYpC684EWu1hO/JU8rkNW6Nn0FFQCIH/p6m6ELkLNQpx+1QJsWWtH/LdW94WinVylhuA4jggQ",\n                        "privilege": {\n                            "db_permission": {\n                                "db1": 0,\n                                "db2": 1\n                            }\n                        }\n                    }\n                },\n                {\n                    "user": {\n                        "id": "bob",\n                        "certificate": "MIIBrzCCAVWgAwIBAgIQZOQpmvY31R8yeyy3ClrJtzAKBggqhkjOPQQDAjAeMRwwGgYDVQQDExNDYXIgcmVnaXN0cnkgUm9vdENBMB4XDTIxMDYxNjExMTMyN1oXDTIyMDYxNjExMTgyN1owIjEgMB4GA1UEAxMXQ2FyIHJlZ2lzdHJ5IENsaWVudCBib2IwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASUDaIwGvRPPHHMzw4UFPTX5BTuPons8Xv3AR6k/8dDJQsn09qdtKWauLLLGxiLNDY2J8S0qPzJhJVPGF6h/l9Uo3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiAFxiyZgtiTwvMFF6jKtUE5vV0YzthpWmdRiUIbUclKzQIhALQolKPJl9xmv66wOyJTvR2q13Fb6j75M4WGcG4KfjDZ",\n                        "privilege": {\n                            "db_permission": {\n                                "db1": 0,\n                                "db2": 0\n                            }\n                        }\n                    },\n                    "acl": {\n                        "read_users": {\n                            "admin": true\n                        }\n                    }\n                }\n          ]\n    },\n    "signature": "MEUCIHLCSwMzwxmnRfB6s1eON2bMfgDwFvxoSqaZ6ACXcbn0AiEA8KhjY56tSRg9Hh9UGchhGybTV2rWl1NcsAPLyW71Vu8="\n}\'\n')),(0,i.kt)("p",null,"The user ",(0,i.kt)("inlineCode",{parentName:"p"},"alice")," has read-only access on the database ",(0,i.kt)("inlineCode",{parentName:"p"},"db1")," and read-write access on the database ",(0,i.kt)("inlineCode",{parentName:"p"},"db2"),". These privileges are defined under ",(0,i.kt)("inlineCode",{parentName:"p"},"db_permission"),".\nThe ",(0,i.kt)("inlineCode",{parentName:"p"},'"db1":0')," denotes that the user has read-only privilege on database ",(0,i.kt)("inlineCode",{parentName:"p"},"db1")," while ",(0,i.kt)("inlineCode",{parentName:"p"},'"db2":1')," denotes that the user has read-write privilege on database ",(0,i.kt)("inlineCode",{parentName:"p"},"db2"),".\nIn other words, ",(0,i.kt)("inlineCode",{parentName:"p"},"0")," denotes read-only privilege and ",(0,i.kt)("inlineCode",{parentName:"p"},"1")," denotes read-write privilege. As the access control is not defined for the user,\nany user can read the credential and privilege of ",(0,i.kt)("inlineCode",{parentName:"p"},"alice"),", but only the ",(0,i.kt)("inlineCode",{parentName:"p"},"admin")," user can modify the properties of the ",(0,i.kt)("inlineCode",{parentName:"p"},"alice")," user."),(0,i.kt)("p",null,"The user ",(0,i.kt)("inlineCode",{parentName:"p"},"bob")," has read-only privilege on the database ",(0,i.kt)("inlineCode",{parentName:"p"},"db1")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"db2"),". Furthermore, only the ",(0,i.kt)("inlineCode",{parentName:"p"},"admin")," user can read the credential and privilege of ",(0,i.kt)("inlineCode",{parentName:"p"},"bob"),"."),(0,i.kt)("p",null,"Moreover, the user ",(0,i.kt)("inlineCode",{parentName:"p"},"bob")," cannot be modified as the ",(0,i.kt)("inlineCode",{parentName:"p"},'"read_write_users"')," section is left empty. This means no user has permission to write to user ",(0,i.kt)("inlineCode",{parentName:"p"},"bob"),"."),(0,i.kt)("p",null,"The signature for the above transaction payload is computed by executing the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'/bin/signer -privatekey=deployment/sample/crypto/admin/admin.key \\\n    -data=\'{"user_id":"admin","tx_id":"7b6d6414-9b58-45d0-9723-1f31712add01","user_writes":[{"user":{"id":"alice","certificate":"MIIBsjCCAVigAwIBAgIRAJp7i/UhOnaawHTSdkzxR1QwCgYIKoZIzj0EAwIwHjEcMBoGA1UEAxMTQ2FyIHJlZ2lzdHJ5IFJvb3RDQTAeFw0yMTA2MTYxMTEzMjdaFw0yMjA2MTYxMTE4MjdaMCQxIjAgBgNVBAMTGUNhciByZWdpc3RyeSBDbGllbnQgYWxpY2UwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASdCmAgHdqck7uhAK5siEF/O1EIUEIYtiR3XVEjbVhNe/6GXFShtsSThXYL9/XK6p4qF4oSy9j/PURMGnWbzSnso3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiEAsRZlR4sDyxS//BJnYpC684EWu1hO/JU8rkNW6Nn0FFQCIH/p6m6ELkLNQpx+1QJsWWtH/LdW94WinVylhuA4jggQ","privilege":{"db_permission":{"db1":0,"db2":1}}}},{"user":{"id":"bob","certificate":"MIIBrzCCAVWgAwIBAgIQZOQpmvY31R8yeyy3ClrJtzAKBggqhkjOPQQDAjAeMRwwGgYDVQQDExNDYXIgcmVnaXN0cnkgUm9vdENBMB4XDTIxMDYxNjExMTMyN1oXDTIyMDYxNjExMTgyN1owIjEgMB4GA1UEAxMXQ2FyIHJlZ2lzdHJ5IENsaWVudCBib2IwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASUDaIwGvRPPHHMzw4UFPTX5BTuPons8Xv3AR6k/8dDJQsn09qdtKWauLLLGxiLNDY2J8S0qPzJhJVPGF6h/l9Uo3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiAFxiyZgtiTwvMFF6jKtUE5vV0YzthpWmdRiUIbUclKzQIhALQolKPJl9xmv66wOyJTvR2q13Fb6j75M4WGcG4KfjDZ","privilege":{"db_permission":{"db1":0,"db2":0}}},"acl":{"read_users":{"admin":true}}}]}\'\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Output")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"MEYCIQCBA3pw0C1wgJMjOYDnhr5C0QeaSfradKdCFVCSWwXFdwIhAP80o5VZY2VBp4Lr5+4lG9hNuFL3Da53LXP9N7uAyNfn\n")),(0,i.kt)("p",null,"Upon a successful commit of the above transaction, the submitter of the transaction receives the following transaction receipt:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-webmanifest"},'{\n  "response": {\n    "header": {\n      "node_id": "bdb-node-1"\n    },\n    "receipt": {\n      "header": {\n        "base_header": {\n          "number": 4,\n          "previous_base_header_hash": "gc2T0zndfbSAsw9J/67Pzjk1IAVBjE9Ih93qjwYro1k=",\n          "last_committed_block_hash": "eUxPHg5TFfTU3CRmYISAHDPI6DRHxbiQccaeytl4WBk=",\n          "last_committed_block_num": 3\n        },\n        "skipchain_hashes": [\n          "eUxPHg5TFfTU3CRmYISAHDPI6DRHxbiQccaeytl4WBk="\n        ],\n        "tx_merkle_tree_root_hash": "5nu+kdyEzZOIcy6qDDCls+GSRKK0aRdp6lbZJBUnZJQ=",\n        "state_merkle_tree_root_hash": "milzir+V4vvodu+e2BPv/j5XKlh6SfJmy3cRsBlJttw=",\n        "validation_info": [\n          {}\n        ]\n      }\n    }\n  },\n  "signature": "MEYCIQDxAuuukwThUp5ytZikobfQ0iBLMYLI6TRoK7322eNuqAIhAI5SkomPRnxH0K3iF6xqNFJUCgTHVuyelFgb9u1B4a8D"\n}\n')),(0,i.kt)("h3",{id:"12-check-the-existence-of-alice"},"1.2) Check the existence of alice"),(0,i.kt)("p",null,"Once the transaction gets committed, we can query the user information as follows:"),(0,i.kt)("p",null,"Let's fetch the user ",(0,i.kt)("inlineCode",{parentName:"p"},"alice"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'./bin/signer -privatekey=deployment/sample/crypto/admin/admin.key \\\n    -data=\'{"user_id":"admin","target_user_id":"alice"}\'\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Output")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"MEYCIQDioRVRhtdaLEjFSeCPqrVCCtdwq+hvy7Y+i3cXaqhZ3wIhAK/gmdftR4x0KF3w8V86hSYXPehf/rlO8QcSnU9sFnvC\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'curl \\\n     -H "Content-Type: application/json" \\\n     -H "UserID: admin" \\\n     -H "Signature: MEYCIQDioRVRhtdaLEjFSeCPqrVCCtdwq+hvy7Y+i3cXaqhZ3wIhAK/gmdftR4x0KF3w8V86hSYXPehf/rlO8QcSnU9sFnvC" \\\n     -X GET http://127.0.0.1:6001/user/alice | jq .\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Output")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-webmanifest"},'{\n  "response": {\n    "header": {\n      "node_id": "bdb-node-1"\n    },\n    "user": {\n      "id": "alice",\n      "certificate": "MIIBsjCCAVigAwIBAgIRAJp7i/UhOnaawHTSdkzxR1QwCgYIKoZIzj0EAwIwHjEcMBoGA1UEAxMTQ2FyIHJlZ2lzdHJ5IFJvb3RDQTAeFw0yMTA2MTYxMTEzMjdaFw0yMjA2MTYxMTE4MjdaMCQxIjAgBgNVBAMTGUNhciByZWdpc3RyeSBDbGllbnQgYWxpY2UwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASdCmAgHdqck7uhAK5siEF/O1EIUEIYtiR3XVEjbVhNe/6GXFShtsSThXYL9/XK6p4qF4oSy9j/PURMGnWbzSnso3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiEAsRZlR4sDyxS//BJnYpC684EWu1hO/JU8rkNW6Nn0FFQCIH/p6m6ELkLNQpx+1QJsWWtH/LdW94WinVylhuA4jggQ",\n      "privilege": {\n        "db_permission": {\n          "db1": 0,\n          "db2": 1\n        }\n      }\n    },\n    "metadata": {\n      "version": {\n        "block_num": 4\n      }\n    }\n  },\n  "signature": "MEYCIQDY3OV2xzqe22X7PzO6UIeDY6t3Qn7DcMk5z/G8SGshvQIhAN8DnATYxIQyoj3jPufgoHuOJDTCnvpEj4kF0WtLHGRq"\n}\n')),(0,i.kt)("h3",{id:"13-check-the-existence-of-bob"},"1.3) Check the existence of bob"),(0,i.kt)("p",null,"Let's fetch the user ",(0,i.kt)("inlineCode",{parentName:"p"},"bob"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'./bin/signer -privatekey=deployment/sample/crypto/admin/admin.key -data=\'{"user_id":"admin","target_user_id":"bob"}\'\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Output")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"MEQCICeSXCL6Atyf3hgbd0XtC4L6HT0qXTxLyvUslAv5pYMqAiAxirniW1NW1lS2pUT8G0XeWYUhUKCjjWlq6WTuGAOxEQ==\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'curl \\\n     -H "Content-Type: application/json" \\\n     -H "UserID: admin" \\\n     -H "Signature: MEQCICeSXCL6Atyf3hgbd0XtC4L6HT0qXTxLyvUslAv5pYMqAiAxirniW1NW1lS2pUT8G0XeWYUhUKCjjWlq6WTuGAOxEQ==" \\\n     -X GET http://127.0.0.1:6001/user/bob | jq .\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Output")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-webmanifest"},'{\n  "response": {\n    "header": {\n      "node_id": "bdb-node-1"\n    },\n    "user": {\n      "id": "bob",\n      "certificate": "MIIBrzCCAVWgAwIBAgIQZOQpmvY31R8yeyy3ClrJtzAKBggqhkjOPQQDAjAeMRwwGgYDVQQDExNDYXIgcmVnaXN0cnkgUm9vdENBMB4XDTIxMDYxNjExMTMyN1oXDTIyMDYxNjExMTgyN1owIjEgMB4GA1UEAxMXQ2FyIHJlZ2lzdHJ5IENsaWVudCBib2IwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASUDaIwGvRPPHHMzw4UFPTX5BTuPons8Xv3AR6k/8dDJQsn09qdtKWauLLLGxiLNDY2J8S0qPzJhJVPGF6h/l9Uo3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiAFxiyZgtiTwvMFF6jKtUE5vV0YzthpWmdRiUIbUclKzQIhALQolKPJl9xmv66wOyJTvR2q13Fb6j75M4WGcG4KfjDZ",\n      "privilege": {\n        "db_permission": {\n          "db1": 0\n        }\n      }\n    },\n    "metadata": {\n      "version": {\n        "block_num": 4\n      },\n      "access_control": {\n        "read_users": {\n          "admin": true\n        }\n      }\n    }\n  },\n  "signature": "MEUCIEuGxnvi2nwzJ1AZdUBhFBkOkv26kOupKZbCgt03S85zAiEAwiyE1xJEl0F9Kx/CyylKP6dogKrcNRiVXMJcqknrOE4="\n}\n')),(0,i.kt)("h2",{id:"2-updating-a-user"},"2) Updating a User"),(0,i.kt)("h3",{id:"21-remove-all-privileges-of-alice"},"2.1) Remove all privileges of ",(0,i.kt)("inlineCode",{parentName:"h3"},"alice")),(0,i.kt)("p",null,"Let's remove all privileges given to ",(0,i.kt)("inlineCode",{parentName:"p"},"alice"),". To do that, we can execute the following steps:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Fetch the current committed information of the user ",(0,i.kt)("inlineCode",{parentName:"li"},"alice"),"."),(0,i.kt)("li",{parentName:"ol"},"Remove the privilege section and construct the transaction payload."),(0,i.kt)("li",{parentName:"ol"},"Add the digital signature on the new transaction payload."),(0,i.kt)("li",{parentName:"ol"},"Submit the transaction payload by issuing a ",(0,i.kt)("inlineCode",{parentName:"li"},"POST /user/tx {txPayload}"))),(0,i.kt)("p",null,"Though we can update multiple users within a transaction, for the sake of simplicity in this example, we are only updating a single user, ",(0,i.kt)("inlineCode",{parentName:"p"},"alice"),"."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},"Important for Successful Execution of this Example:"),"\nThe ",(0,i.kt)("inlineCode",{parentName:"p"},"user_reads")," section in the below transaction payload contains a version of the read information. If this does not match the committed version, the transaction would be invalidated.\nThis is useful because the ",(0,i.kt)("inlineCode",{parentName:"p"},"alice")," user can be updated by any other admin between step 1 and 2 listed above.\nTo ensure serializability isolation, we must pass the read version. In our example, we use the version present in ",(0,i.kt)("a",{parentName:"p",href:"#check-the-existence-of-alice-and-bob"},"this"),"\nreturned result. To be specific, we can see the version in the metadata section of the query result as shown below:"),(0,i.kt)("pre",{parentName:"blockquote"},(0,i.kt)("code",{parentName:"pre",className:"language-webmanifest"},'    "metadata": {\n      "version": {\n        "block_num": 3\n      }\n    }\n')),(0,i.kt)("p",{parentName:"blockquote"},"This version might be different for you. Hence, provide the appropriate version number in the transaction payload and compute the digital signature.")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"user_reads")," section states you should commit this transaction only if the users specified in the ",(0,i.kt)("inlineCode",{parentName:"p"},"user_reads")," list are at a specified version as per the current committed state. Otherwise, invalidate the transaction and do not apply the changes requested by the transaction."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Note that it is not necessary to pass the version in ",(0,i.kt)("inlineCode",{parentName:"p"},"user_reads"),". If the ",(0,i.kt)("inlineCode",{parentName:"p"},"user_reads")," is left out, the write would be considered as a blind write.")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Within a single transaction, we can update more than a single user. For the sake of simplicity, the example updates a single user only.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},' curl \\\n   -H "Content-Type: application/json" \\\n   -H "TxTimeout: 2s" \\\n   -X POST http://127.0.0.1:6001/user/tx \\\n   --data \'{\n    "payload": {\n        "user_id": "admin",\n        "tx_id": "1b6d6414-9b58-45d0-9723-1f31712add02",\n        "user_reads": [\n            {\n                "user_id": "alice",\n                "version": {\n                    "block_num": 3\n                }\n            }\n        ],\n        "user_writes": [\n            {\n                "user": {\n                    "id": "alice",\n                    "certificate": "MIIBsjCCAVigAwIBAgIRAJp7i/UhOnaawHTSdkzxR1QwCgYIKoZIzj0EAwIwHjEcMBoGA1UEAxMTQ2FyIHJlZ2lzdHJ5IFJvb3RDQTAeFw0yMTA2MTYxMTEzMjdaFw0yMjA2MTYxMTE4MjdaMCQxIjAgBgNVBAMTGUNhciByZWdpc3RyeSBDbGllbnQgYWxpY2UwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASdCmAgHdqck7uhAK5siEF/O1EIUEIYtiR3XVEjbVhNe/6GXFShtsSThXYL9/XK6p4qF4oSy9j/PURMGnWbzSnso3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiEAsRZlR4sDyxS//BJnYpC684EWu1hO/JU8rkNW6Nn0FFQCIH/p6m6ELkLNQpx+1QJsWWtH/LdW94WinVylhuA4jggQ"\n                }\n            }\n        ]\n    },\n    "signature": "MEUCIDTrlQ8fKu2ZeVWincE8RzWd/Y/MWjZGHEu37EckcTFnAiEA/kmKAOc2LK2GHFIA1wU+9/oog0Nqj3GLYPjSFGCeOOk="\n}\'\n')),(0,i.kt)("p",null,"In the above transaction, we removed the privilege section from the user information (compare against the query result provided ",(0,i.kt)("a",{parentName:"p",href:"#check-the-existence-of-alice-and-bob"},"here"),").\nThe signature is computed using the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'./bin/signer -privatekey=deployment/sample/crypto/admin/admin.key -data=\'{"user_id":"admin","tx_id":"1b6d6414-9b58-45d0-9723-1f31712add02","user_reads":[{"user_id":"alice","version":{"block_num":3}}],"user_writes":[{"user":{"id":"alice","certificate":"MIIBsjCCAVigAwIBAgIRAJp7i/UhOnaawHTSdkzxR1QwCgYIKoZIzj0EAwIwHjEcMBoGA1UEAxMTQ2FyIHJlZ2lzdHJ5IFJvb3RDQTAeFw0yMTA2MTYxMTEzMjdaFw0yMjA2MTYxMTE4MjdaMCQxIjAgBgNVBAMTGUNhciByZWdpc3RyeSBDbGllbnQgYWxpY2UwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASdCmAgHdqck7uhAK5siEF/O1EIUEIYtiR3XVEjbVhNe/6GXFShtsSThXYL9/XK6p4qF4oSy9j/PURMGnWbzSnso3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiEAsRZlR4sDyxS//BJnYpC684EWu1hO/JU8rkNW6Nn0FFQCIH/p6m6ELkLNQpx+1QJsWWtH/LdW94WinVylhuA4jggQ"}}]}\'\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Output")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"MEQCIGy62qM0ZGdCd5FsCvgKJ0wVQi/uL5Gy0IXhevsNxUaeAiA2pOfu5vVuQ9MJnYakFyw8HcgHR6AA3NqyxF8p3E6exw==\n")),(0,i.kt)("h3",{id:"22-check-the-privilege-of-alice"},"2.2) Check the privilege of ",(0,i.kt)("inlineCode",{parentName:"h3"},"alice")),(0,i.kt)("p",null,"Once the transaction get committed, we can query the user information as follows to check whether all privileges given to the ",(0,i.kt)("inlineCode",{parentName:"p"},"alice")," user have been removed:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'curl \\\n     -H "Content-Type: application/json" \\\n     -H "UserID: admin" \\\n     -H "Signature: MEYCIQDioRVRhtdaLEjFSeCPqrVCCtdwq+hvy7Y+i3cXaqhZ3wIhAK/gmdftR4x0KF3w8V86hSYXPehf/rlO8QcSnU9sFnvC" \\\n     -X GET http://127.0.0.1:6001/user/alice | jq .\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Output")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-webmanifest"},'{\n  "response": {\n    "header": {\n      "node_id": "bdb-node-1"\n    },\n    "user": {\n      "id": "alice",\n      "certificate": "MIIBsjCCAVigAwIBAgIRAJp7i/UhOnaawHTSdkzxR1QwCgYIKoZIzj0EAwIwHjEcMBoGA1UEAxMTQ2FyIHJlZ2lzdHJ5IFJvb3RDQTAeFw0yMTA2MTYxMTEzMjdaFw0yMjA2MTYxMTE4MjdaMCQxIjAgBgNVBAMTGUNhciByZWdpc3RyeSBDbGllbnQgYWxpY2UwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASdCmAgHdqck7uhAK5siEF/O1EIUEIYtiR3XVEjbVhNe/6GXFShtsSThXYL9/XK6p4qF4oSy9j/PURMGnWbzSnso3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiEAsRZlR4sDyxS//BJnYpC684EWu1hO/JU8rkNW6Nn0FFQCIH/p6m6ELkLNQpx+1QJsWWtH/LdW94WinVylhuA4jggQ",\n    },\n    "metadata": {\n      "version": {\n        "block_num": 5\n      }\n    }\n  },\n  "signature": "MEYCIQDY3OV2xzqe22X7PzO6UIeDY6t3Qn7DcMk5z/G8SGshvQIhAN8DnATYxIQyoj3jPufgoHuOJDTCnvpEj4kF0WtLHGRq"\n}\n')),(0,i.kt)("p",null,"As we can see, the privilege section is no longer present and the version has been increased too."),(0,i.kt)("h2",{id:"3-deleting-a-user"},"3) Deleting a User"),(0,i.kt)("h3",{id:"31-delete-the-user-alice"},"3.1) Delete the user ",(0,i.kt)("inlineCode",{parentName:"h3"},"alice")),(0,i.kt)("p",null,"Let's delete ",(0,i.kt)("inlineCode",{parentName:"p"},"alice")," from the cluster. In order to do that, we execute the following steps:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Fetch the current committed information of the ",(0,i.kt)("inlineCode",{parentName:"li"},"alice")," user to get the committed version."),(0,i.kt)("li",{parentName:"ol"},"Add the committed version to the ",(0,i.kt)("inlineCode",{parentName:"li"},"user_reads"),"."),(0,i.kt)("li",{parentName:"ol"},"Add the ",(0,i.kt)("inlineCode",{parentName:"li"},"alice")," user to the ",(0,i.kt)("inlineCode",{parentName:"li"},"user_deletes"),"."),(0,i.kt)("li",{parentName:"ol"},"Compute and add the digital signature to the transaction payload."),(0,i.kt)("li",{parentName:"ol"},"Submit the transaction payload by issuing a ",(0,i.kt)("inlineCode",{parentName:"li"},"POST /user/tx {txPayload}"),".")),(0,i.kt)("p",null,"The example uses ",(0,i.kt)("inlineCode",{parentName:"p"},'"block_num": 4')," as the version. While executing this example, query the user ",(0,i.kt)("inlineCode",{parentName:"p"},"alice")," and use the version provided in the output of that query.\nRefer ",(0,i.kt)("a",{parentName:"p",href:"#updation-of-a-user"},"here")," for the query result of ",(0,i.kt)("inlineCode",{parentName:"p"},"alice")," after being updated. In the query result, we have"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-webmanifest"},'    "metadata": {\n      "version": {\n        "block_num": 4\n      }\n    }\n')),(0,i.kt)("p",null,"Hence, this example uses ",(0,i.kt)("inlineCode",{parentName:"p"},'"block_num": 4')," as the version."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Note that it is not necessary to pass the version in ",(0,i.kt)("inlineCode",{parentName:"p"},"user_reads"),". If the ",(0,i.kt)("inlineCode",{parentName:"p"},"user_reads")," is left out, the delete would be considered as a blind delete. For blind deletes, steps 1 and 2 are not needed.")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Within a single transaction, we can delete more than a single user. For the sake of simplicity, the example deletes a single user only.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},' curl \\\n   -H "Content-Type: application/json" \\\n   -H "TxTimeout: 2s" \\\n   -X POST http://127.0.0.1:6001/user/tx \\\n   --data \'{\n    "payload": {\n        "user_id": "admin",\n        "tx_id": "1b6d6414-9b58-45d0-9723-1f31712add04",\n        "user_reads": [\n            {\n                "user_id": "alice",\n                "version": {\n                    "block_num": 4\n                }\n            }\n        ],\n        "user_deletes": [\n            {\n                "user_id": "alice"\n            }\n        ]\n    },\n    "signature": "MEQCID1O2vmSxgzJT8KNMws/ckV1oIf1R4oml6aWeZNzvjI9AiAphdfNAn+VKCJPPh+d0oW4/MH+cXy4xwQXXU5FQ8LpMQ=="\n}\'\n')),(0,i.kt)("p",null,"The section ",(0,i.kt)("inlineCode",{parentName:"p"},"user_deletes")," is an array and we can pass many users in it if we want, and all will be deleted if they exist.\nThe signature on the payload is computed using the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'./bin/signer -privatekey=deployment/sample/crypto/admin/admin.key -data=\'{"user_id":"admin","tx_id":"1b6d6414-9b58-45d0-9723-1f31712add04","user_reads":[{"user_id":"alice","version":{"block_num":4}}],"user_deletes":[{"user_id":"alice"}]}\'\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Output")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"MEQCID1O2vmSxgzJT8KNMws/ckV1oIf1R4oml6aWeZNzvjI9AiAphdfNAn+VKCJPPh+d0oW4/MH+cXy4xwQXXU5FQ8LpMQ==\n")),(0,i.kt)("p",null,"Once the transaction is validated and committed, the submitter of the transaction receives the following transaction receipt:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-webmanifest"},'{\n  "response": {\n    "header": {\n      "node_id": "bdb-node-1"\n    },\n    "receipt": {\n      "header": {\n        "base_header": {\n          "number": 7,\n          "previous_base_header_hash": "+KCuJm2x9LzsIBFmAVkW6w/Hmw7IRjl52aZjNI7juR8=",\n          "last_committed_block_hash": "7nEaUCRBiGvmrhbhl7tzupb0K/KjGdS/SSJtCLjvsjA=",\n          "last_committed_block_num": 6\n        },\n        "skipchain_hashes": [\n          "7nEaUCRBiGvmrhbhl7tzupb0K/KjGdS/SSJtCLjvsjA=",\n          "IHP38VOoGoVHAHROXPZJ8ZWG3pZ6rmqQYovVzm5i7rw="\n        ],\n        "tx_merkle_tree_root_hash": "iz84iY89BolcBkVD8okAAqg5duGT/+eivcTO4OcpnNM=",\n        "state_merkle_tree_root_hash": "tAb0KTsd9JgCQ1YZMwYLs2O3wpo0ynA7h22B8pKzBC0=",\n        "validation_info": [\n          {}\n        ]\n     }\n    }\n  },\n  "signature": "MEUCIGWLKxgnxwlznZyBbKbpiFcnbUv32CbkBaFitOxEWnSMAiEAqcNh9pswgvF7f1leWrteozij2zSlG78gcfP5+eAfHhA="\n}\n')),(0,i.kt)("h3",{id:"32-check-the-non-existence-of-the-user-alice"},"3.2) Check the non-existence of the user ",(0,i.kt)("inlineCode",{parentName:"h3"},"alice")),(0,i.kt)("p",null,"If we query the user, the response does not contain any details associated with the user."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'curl \\\n     -H "Content-Type: application/json" \\\n     -H "UserID: admin" \\\n     -H "Signature: MEYCIQDioRVRhtdaLEjFSeCPqrVCCtdwq+hvy7Y+i3cXaqhZ3wIhAK/gmdftR4x0KF3w8V86hSYXPehf/rlO8QcSnU9sFnvC" \\\n     -X GET http://127.0.0.1:6001/user/alice | jq .\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Output")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-webmanifest"},'{\n  "response": {\n    "header": {\n      "node_id": "bdb-node-1"\n    }\n  },\n  "signature": "MEUCIDV6UgjPLtM5c+WqQ+Ue5xcKe/w85nAdwwRl7qPqJByVAiEA4RTqXa8Xf8S+O8YPRpFgIHzOCH5jOHkL2jMmLG7Zdpw="\n}\n')))}p.isMDXComponent=!0}}]);